function e(e,t){let[n,l]=function(e=defaultState){let t=e;return[function(){return t},function(e){t=e}]}(t);return[n,function(t){l(e(n(),t))}]}function t(e,t){switch(t.type){case"setActiveRow":return{...e,R:t.value};case"setActiveColumn":return{...e,C:t.value};case"reset":return defaultState;default:return e}}function n(n){let l=document.getElementById(n),[r,a]=e(t,{R:0,C:0});function o(e){let t=document.createElement("input");return t.addEventListener("focus",(function(e){let n=e.target.parentElement.cellIndex;!function(e,n){a({type:"setActiveRow",value:e}),a({type:"setActiveColumn",value:n});let l=document.querySelector("[selected]");l&&l.removeAttribute("selected"),t.setAttribute("selected","true")}(e.target.parentElement.parentElement.rowIndex,n)})),t.value=e,t}function c(e){let t=document.createElement("td");return t.appendChild(o(e)),t}function i(e){let t=document.createElement("tr");for(let n=0;n<e.length;n++)t.appendChild(c(e[n]));return t}return l.addEventListener("keydown",(function(e){r();if("Enter"===e.key){e.preventDefault();let t=e.target;"INPUT"===t.tagName&&(e.shiftKey?function(){let e=r(),t=l.rows[e.R-1];if(t){let n=t.cells[e.C].children[0];n.focus(),n.select()}}():function(e){let t=r(),n=l.rows[t.R+1];if(n){let e=n.cells[t.C].children[0];e.focus(),e.select()}else{let n=e.parentElement.parentElement,r=i(Array(n.children.length).fill(""));l.appendChild(r);let a=r.cells[t.C].children[0];a.focus(),a.select()}}(t))}if("Tab"===e.key){e.preventDefault(),"INPUT"===e.target.tagName&&(e.shiftKey?function(){let e=r(),t=l.rows[e.R].cells[e.C-1];if(t){let e=t.children[0];e.focus(),e.select()}}():function(){let e=r(),t=l.rows[e.R].cells[e.C+1];if(t){let e=t.children[0];e.focus(),e.select()}else{for(let e=0;e<l.rows.length;e++){let t=l.rows[e],n=c("");t.appendChild(n)}let t=l.rows[e.R].cells[e.C+1].children[0];t.focus(),t.select()}}())}})),{align:function(e){let t=document.getElementById(n),l=r().C;for(let n=0;n<t.rows.length;n++){let r=t.rows[n].cells[l].children[0];r.setAttribute("align",e),r.classList.remove("text-left"),r.classList.remove("text-right"),r.classList.remove("text-center"),r.classList.add(`text-${e}`)}},createRow:i,toJson:function(){let e=document.getElementById(n).rows,t={data:[],alignment:[],colMaxChars:[]};for(let n=0;n<e.length;n++){let l=e[n],r=[];for(let e=0;e<l.cells.length;e++){let a=l.cells[e].children[0],o=a.value,c=o.length>3?o.length:3;colMaxChars=t.colMaxChars[e]||3,c>colMaxChars&&(t.colMaxChars[e]=c),r.push(o),0===n&&t.alignment.push(a.getAttribute("align")??"left")}t.data.push(r)}return t},fromJson:function(e){let t=document.getElementById(n);t.innerHTML="";for(let n=0;n<e.data.length;n++){let l=e.data[n],r=document.createElement("tr");for(let t=0;t<l.length;t++){let n=document.createElement("td"),a=o(l[t]),c=e.alignment[t]??"left";a.setAttribute("align",c),a.classList.add(`text-${c}`),n.appendChild(a),r.appendChild(n)}t.appendChild(r)}},renderTable:function(e){let t=document.getElementById("table");for(let n=0;n<e.length;n++)t.appendChild(i(e[n]))},insertRow:function(){let e=document.getElementById(n),t=e.rows[r().R],l=i(Array(t.children.length).fill(""));e.insertBefore(l,t)},insertColumn:function(){let e=document.getElementById(n),t=r().C;for(let n=0;n<e.rows.length;n++){let l=e.rows[n],r=c("");l.insertBefore(r,l.children[t])}},deleteColumn:function(){let e=document.getElementById(n);if(1===e.rows[0].cells.length)return;let t=r();for(let n=0;n<e.rows.length;n++){e.rows[n].deleteCell(t.C)}t.C>=e.rows[0].cells.length&&t.C--;let l=e.rows[t.R].cells[t.C].children[0];l.focus(),l.select()},deleteRow:function(){let e=document.getElementById(n);if(1===e.rows.length)return;let t=r();e.deleteRow(t.R),t.R>=e.rows.length&&t.R--;let l=e.rows[t.R].cells[t.C].children[0];l.focus(),l.select()},tableState:r}}function l(e="tableData",t={data:[],alignment:[]}){return{load:function(n=t){let l=localStorage.getItem(e);return l?JSON.parse(l):{data:n.data,alignment:n.alignment}},destroy:function(){localStorage.removeItem(e)},save:function(t){localStorage.setItem(e,JSON.stringify(t))},defaultTable:t}}let r="lastAction";function a(e,t){return{mutate:function(n){let l=document.getElementById("undoButton"),[a,o]=[function(){let e=JSON.parse(localStorage.getItem(r));return e||(e=[]),e},function(e){localStorage.setItem(r,JSON.stringify(e))}],c=a();if("undo"===n)return void(c&&(l.classList.add("hidden"),e.fromJson(c.data),t.save(c.data)));switch(localStorage.setItem("lastAction",JSON.stringify({data:e.toJson(),action:n})),l.classList.remove("hidden"),n){case"alignLeft":e.align("left");break;case"alignCenter":e.align("center");break;case"alignRight":e.align("right");break;case"insertRow":e.insertRow();break;case"insertColumn":e.insertColumn();break;case"deleteRow":e.deleteRow();break;case"deleteColumn":e.deleteColumn();break;case"resetTable":confirm("Are you sure you want to clear?")&&e.fromJson(t.defaultTable);break;default:console.log("Action not found")}t.save(e.toJson())}}}const o={data:[["Let’s get table’n","Persist me!"],["",""],["",""],["",""]],alignment:[null,null,null,null]};function c(e=o){let t="";for(let n=0;n<e.data.length;n++){let l=e.data[n];for(let n=0;n<l.length;n++){let r=l[n],a=e.colMaxChars[n]-r.length,o=e.alignment[n];if("left"==o)a>0&&(r+=" ".repeat(a)),t+=`| ${r} `;else if("right"==o)a>0&&(r=" ".repeat(a)+r),t+=`| ${r} `;else{let e=Math.floor(a/2),n=a-e;e>0&&(r=" ".repeat(e)+r),n>0&&(r+=" ".repeat(n)),t+=`| ${r} `}}if(t+="|\n",0==n){for(let n=0;n<l.length;n++){let l=e.alignment[n];if("left"==l){t+=`|:${"-".repeat(e.colMaxChars[n])}:`}else if("right"==l){t+=`|${"-".repeat(e.colMaxChars[n]+1)}:`}else if("center"==l){t+=`|:${"-".repeat(e.colMaxChars[n])}:`}else{t+=`|${"-".repeat(e.colMaxChars[n]+2)}`}}t+="|\n"}}return t}function i(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;")+"\n"}function s(e){let t="";for(let n of e.data){t+=i("<tr>");for(let e of n)t+="\t"+i(`<td>${e}</td>`);t+=i("</tr>")}return t}function u(e,t){return function(n){let l=e.toJson();t.save(l);let r=document.getElementById("generated");switch(n){case"markdown":r.setAttribute("format","markdown"),r.innerHTML=c(l);break;case"html":r.setAttribute("format","html"),r.innerHTML=s(l);break;case"json":r.setAttribute("format","json"),r.innerHTML=JSON.stringify(l,null,2);break;default:console.log("Action not found")}}}let d=function(e,t,r){let o=n(e),c=l(t,r),i=a(o,c).mutate,s=u(o,c);return o.fromJson(c.load(r)),{mutate:i,generate:s}}("table","tableData",{data:[["",""],["",""],["",""],["",""]],alignment:[],colMaxChars:[]});d.generate("markdown");let f=document.getElementById("table-controls"),g=document.getElementById("generate-on-change"),m=document.getElementById("table");function h(e){if(!("INPUT"===e.target.nodeName))return;let t=document.getElementById("generated").getAttribute("format")??"markdown";d.generate(t)}document.getElementById("clear-storage").addEventListener("click",(function(e){"BUTTON"===e.target.nodeName&&(localStorage.clear(),location.reload())})),f.addEventListener("click",(function(e){if(!("BUTTON"===e.target.nodeName))return;let t=e.target.getAttribute("mutation");if(t)return d.mutate(t);let n=e.target.getAttribute("generation");return n?d.generate(n):void 0})),g.addEventListener("change",(function(e){"INPUT"===e.target.nodeName&&(e.target.checked?(console.log("generate on change"),m.addEventListener("input",h)):(console.log("do not generate on change"),m.removeEventListener("input",h)))}));
//# sourceMappingURL=index.bc1affca.js.map
